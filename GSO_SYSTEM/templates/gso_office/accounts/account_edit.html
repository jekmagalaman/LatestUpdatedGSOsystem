{% extends "gso_office/gso_base_dashboard.html" %}
{% load widget_tweaks %}

{% block title %}Edit User{% endblock %}

{% block main_content %}
<div class="container mt-4 mb-5">
  <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
    <!-- Header -->
    <div class="card-header d-flex justify-content-between align-items-center py-3 px-4" style="background-color: #0d47a1;">
      <h4 class="mb-0 text-white fw-semibold">
        <i class="bi bi-person-gear me-2"></i>Edit User â€”
        {% if user.role == "requestor" %}
          {{ user.department }}
        {% else %}
          {{ user.get_full_name }}
        {% endif %}
      </h4>
      <a href="{% url 'gso_accounts:account_management' %}" class="btn btn-outline-light btn-sm">
        <i class="bi bi-arrow-left me-1"></i> Back
      </a>
    </div>

    <!-- Body -->
    <div class="card-body px-4 py-4 bg-white">
      <form method="post" class="needs-validation" novalidate>
        {% csrf_token %}

        <div class="row g-3">
          <!-- Role -->
          <div class="col-md-6">
            <label for="id_role" class="form-label fw-semibold text-uppercase text-primary small">Role</label>
            {{ form.role|add_class:"form-select shadow-sm" }}
          </div>

          <!-- Unit -->
          <div class="col-md-6" id="unitField">
            <label for="id_unit" class="form-label fw-semibold text-uppercase text-primary small">Unit</label>
            {{ form.unit|add_class:"form-select shadow-sm" }}
          </div>

          <!-- First Name -->
          <div class="col-md-6" id="firstNameField">
            <label for="id_first_name" class="form-label fw-semibold text-uppercase text-primary small">First Name</label>
            {{ form.first_name|add_class:"form-control shadow-sm" }}
          </div>

          <!-- Username -->
          <div class="col-md-6" id="usernameField">
            <label for="id_username" class="form-label fw-semibold text-uppercase text-primary small">Username</label>
            {{ form.username|add_class:"form-control shadow-sm" }}
          </div>

          <!-- Last Name -->
          <div class="col-md-6" id="lastNameField">
            <label for="id_last_name" class="form-label fw-semibold text-uppercase text-primary small">Last Name</label>
            {{ form.last_name|add_class:"form-control shadow-sm" }}
          </div>

          <!-- Department -->
          <div class="col-md-6" id="deptField">
            <label for="id_department" class="form-label fw-semibold text-uppercase text-primary small">Department</label>
            {{ form.department|add_class:"form-select shadow-sm" }}
          </div>

          <!-- Status -->
          <div class="col-md-6">
            <label for="id_account_status" class="form-label fw-semibold text-uppercase text-primary small">Status</label>
            {{ form.account_status|add_class:"form-select shadow-sm" }}
          </div>
        </div>

        <!-- Buttons -->
        <div class="mt-5 d-flex flex-wrap gap-2">
          <button type="submit" class="btn btn-success px-4 py-2 shadow-sm d-flex align-items-center">
            <i class="bi bi-save me-2"></i> Save Changes
          </button>
          <a href="{% url 'gso_accounts:account_management' %}" class="btn btn-outline-secondary px-4 py-2 shadow-sm d-flex align-items-center">
            <i class="bi bi-x-lg me-2"></i> Cancel
          </a>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- ===== Script for Dynamic Field Visibility ===== -->
<script>
document.addEventListener("DOMContentLoaded", function() {
  const roleField = document.getElementById("id_role");
  const username = document.getElementById("usernameField");
  const firstName = document.getElementById("firstNameField");
  const lastName = document.getElementById("lastNameField");
  const unitField = document.getElementById("unitField");
  const deptField = document.getElementById("deptField");

  function toggleFields() {
    if (!roleField) return;

    username.style.display = "block";
    firstName.style.display = "block";
    lastName.style.display = "block";
    unitField.style.display = "block";
    deptField.style.display = "block";

    if (roleField.value === "requestor") {
      firstName.style.display = "none";
      lastName.style.display = "none";
      unitField.style.display = "none";
    } 
    else if (roleField.value === "gso" || roleField.value === "director") {
      unitField.style.display = "none";
      deptField.style.display = "none";
    } 
    else {
      deptField.style.display = "none";
    }
  }

  roleField.addEventListener("change", toggleFields);
  toggleFields();
});
</script>
{% endblock %}
